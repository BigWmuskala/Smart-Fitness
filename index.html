<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FITNESS AI - PRO SKELETON</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

<style>
body { margin:0; background:#050505; color:white; font-family:sans-serif; }
.app { max-width:600px; margin:auto; padding-bottom:100px; }
.card { background:#111; margin:15px; padding:20px; border-radius:12px; }
.canvas-container { position:relative; width:100%; aspect-ratio:4/3; }
canvas { width:100%; height:100%; transform:scaleX(-1); }
.meter-container { position:absolute; right:15px; top:20%; width:20px; height:60%; background:#222; }
#progress-fill { position:absolute; bottom:0; width:100%; height:0%; background:#00f2ff; }
.btn { padding:15px; width:100%; margin-top:10px; }
.hidden { display:none; }
</style>
</head>

<body>

<div class="app">

<div id="home">
<div class="card">
<h2>Kies oefening</h2>
<button class="btn" onclick="setGoal('legs')">Squats</button>
<button class="btn" onclick="setGoal('push')">Push-ups</button>
</div>
</div>

<div id="workout" class="hidden">
<div class="card">
<h2 id="title"></h2>
<div>Reps: <span id="rep">0</span>/12</div>

<div class="canvas-container">
<div class="meter-container"><div id="progress-fill"></div></div>
<canvas id="canvas" width="640" height="480"></canvas>
</div>

<button class="btn" onclick="location.reload()">Stop</button>
</div>
</div>

</div>

<script>
let pose, camera, ctx;
let reps=0;
let status="up";
let goal="legs";

function setGoal(g){
goal=g;
document.getElementById("home").classList.add("hidden");
document.getElementById("workout").classList.remove("hidden");
document.getElementById("title").innerText = g==="legs"?"SQUATS":"PUSH UPS";
start();
}

function speak(t){
speechSynthesis.cancel();
speechSynthesis.speak(new SpeechSynthesisUtterance(t));
}

function angle(a,b,c){
let r = Math.atan2(c.y-b.y,c.x-b.x)-Math.atan2(a.y-b.y,a.x-b.x);
let d = Math.abs(r*180/Math.PI);
return d>180?360-d:d;
}

async function start(){
ctx = canvas.getContext("2d");
const video=document.createElement("video");

pose = new Pose({locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${f}`});
pose.setOptions({
modelComplexity:1,
smoothLandmarks:true,
minDetectionConfidence:0.5,
minTrackingConfidence:0.5
});
pose.onResults(onResults);

camera = new Camera(video,{
onFrame: async()=> await pose.send({image:video}),
width:640,height:480
});

camera.start().catch(()=>alert("Camera niet beschikbaar"));
}

function onResults(res){
ctx.clearRect(0,0,canvas.width,canvas.height);
ctx.drawImage(res.image,0,0,canvas.width,canvas.height);

if(!res.poseLandmarks) return;

drawConnectors(ctx,res.poseLandmarks,POSE_CONNECTIONS);
drawLandmarks(ctx,res.poseLandmarks);

const lm=res.poseLandmarks;
const fill=document.getElementById("progress-fill");

if(goal==="legs"){

let lk=angle(lm[23],lm[25],lm[27]);
let rk=angle(lm[24],lm[26],lm[28]);
let k=(lk+rk)/2;

let pct=Math.min(Math.max((170-k)/60*100,0),100);
fill.style.height=pct+"%";

if(k<130 && status==="up") status="down";

if(k>165 && status==="down"){
status="up";
count();
}

} else {

let la=angle(lm[11],lm[13],lm[15]);
let ra=angle(lm[12],lm[14],lm[16]);
let a=(la+ra)/2;

let pct=Math.min(Math.max((160-a)/70*100,0),100);
fill.style.height=pct+"%";

if(a<100 && status==="up") status="down";

if(a>150 && status==="down"){
status="up";
count();
}
}
}

function count(){
reps++;
rep.innerText=reps;
speak(reps);
}
</script>

</body>
</html>

